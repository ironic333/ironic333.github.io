<!DOCTYPE html>





<html class="theme-next pisces use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="generator" content="Hexo 3.9.0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/doughnut_32px_1230677_easyicon.net.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/doughnut_16px_1230677_easyicon.net.png?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.3.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    save_scroll: false,
    copycode: {"enable":false,"show_result":false,"style":null},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    }
  };
</script>

  <meta name="description" content="0.学习目标 使用资料搭建后台系统 会使用nginx进行反向代理 实现商品分类查询功能 掌握cors解决跨域 实现品牌查询功能">
<meta name="keywords" content="-微服务">
<meta property="og:type" content="article">
<meta property="og:title" content="商品分类(vuetify-nginx-cors)">
<meta property="og:url" content="https://ironic333.github.io/2019/12/02/day06/index.html">
<meta property="og:site_name" content="MaoLin&#39;s blog">
<meta property="og:description" content="0.学习目标 使用资料搭建后台系统 会使用nginx进行反向代理 实现商品分类查询功能 掌握cors解决跨域 实现品牌查询功能">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530555871804.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530367369490.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530367589197.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530367781173.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530368695265.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530374769782.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530374827792.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1540706914029.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530374954209.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530375152204.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1525962755237.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1525964023585.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1543399927909.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1525960652724.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530555978248.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1525960312939.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1525961862771.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1525961875288.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530380040278.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1525965779366.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1532577155616.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530380292558.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1525966180568.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530556073565.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530382550630.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530382601757.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530383586463.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530383612716.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530383927461.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1532578408206.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1526187409033.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1526016663674.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/0C36B84E.gif">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530556268445.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530384792790.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1526188831504.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1532579488518.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530385593052.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1526189945180.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530556389224.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1525999774439.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1545220121941.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1545220316442.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1545220394460.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1545219777406.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530427294644.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530427514123.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530444682670.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530445885707.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530450599897.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530450744567.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530455133230.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530455291468.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530455437899.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530460311064.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530462650711.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530463010927.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1526021968036.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1545221218980.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1543066995215.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530541070271.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530541222679.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530543778541.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530549253999.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530549095150.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1526033988251.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1526034150067.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1526041205846.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1543067111272.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1526048143014.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1526048275064.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/9.gif">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1526049643506.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/22.gif">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1526049939985.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1526050032436.png">
<meta property="og:image" content="https://ironic333.github.io/images/day06/1530555740595.png">
<meta property="og:updated_time" content="2019-12-02T11:58:59.808Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="商品分类(vuetify-nginx-cors)">
<meta name="twitter:description" content="0.学习目标 使用资料搭建后台系统 会使用nginx进行反向代理 实现商品分类查询功能 掌握cors解决跨域 实现品牌查询功能">
<meta name="twitter:image" content="https://ironic333.github.io/images/day06/1530555871804.png">
  <link rel="alternate" href="/atom.xml" title="MaoLin's blog" type="application/atom+xml">
  <link rel="canonical" href="https://ironic333.github.io/2019/12/02/day06/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>商品分类(vuetify-nginx-cors) | MaoLin's blog</title>
  








  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="stylesheet" href="\assets\css\APlayer.min.css" class="aplayer-style-marker">
<script src="\assets\js\APlayer.min.js" class="aplayer-script-marker"></script>
<script src="\assets\js\Meting.min.js" class="meting-script-marker"></script>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  <div class="container sidebar-position-left">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">MaoLin's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger">
        
          <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
      </li>
    
  </ul>

</nav>
  <div class="site-search">
    
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>


  </div>
</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content page-post-detail">
            

  <div id="posts" class="posts-expand">
    

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ironic333.github.io/2019/12/02/day06/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Andrew">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/wang.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MaoLin's blog">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">商品分类(vuetify-nginx-cors)

            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-12-02 19:55:06 / 修改时间：19:58:59" itemprop="dateCreated datePublished" datetime="2019-12-02T19:55:06+08:00">2019-12-02</time>
            </span>
          
            

            
          

          
            <span class="post-meta-item" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="0-学习目标"><a href="#0-学习目标" class="headerlink" title="0.学习目标"></a>0.学习目标</h1><ul>
<li>使用资料搭建后台系统</li>
<li>会使用nginx进行反向代理</li>
<li>实现商品分类查询功能</li>
<li>掌握cors解决跨域</li>
<li>实现品牌查询功能</li>
</ul>
<a id="more"></a>
<h1 id="1-搭建后台管理前端"><a href="#1-搭建后台管理前端" class="headerlink" title="1.搭建后台管理前端"></a>1.搭建后台管理前端</h1><h2 id="1-1-导入已有资源"><a href="#1-1-导入已有资源" class="headerlink" title="1.1.导入已有资源"></a>1.1.导入已有资源</h2><p>后台项目相对复杂，为了有利于教学，我们不再从0搭建项目，而是直接使用课前资料中给大家准备好的源码：</p>
<p><img src="/images/day06/1530555871804.png" alt="1530555871804"></p>
<p>我们解压缩，放到工作目录中：</p>
<p><img src="/images/day06/1530367369490.png" alt="1530367369490"></p>
<p>然后在Intellij idea中导入新的工程：</p>
<p><img src="/images/day06/1530367589197.png" alt="1530367589197"></p>
<p>选中我们的工程：</p>
<p> <img src="/images/day06/1530367781173.png" alt="1530367781173"></p>
<h2 id="1-2-安装依赖"><a href="#1-2-安装依赖" class="headerlink" title="1.2.安装依赖"></a>1.2.安装依赖</h2><p>你应该注意到，这里并没有node_modules文件夹，方便给大家下发，已经把依赖都删除了。不过package.json中依然定义了我们所需的一切依赖：</p>
<p><img src="/images/day06/1530368695265.png" alt="1530368695265"></p>
<p>我们只需要打开终端，进入项目目录，输入：<code>npm install</code>命令，即可安装这些依赖。</p>
<p><img src="/images/day06/1530374769782.png" alt="1530374769782"></p>
<p>大概需要几分钟。</p>
<p><strong>如果安装过程出现以下问题</strong>：</p>
<p><img src="/images/day06/1530374827792.png" alt="1530374827792"></p>
<p>建议删除node_modules目录，重新安装。或者copy其他人的node_modules使用</p>
<h2 id="1-3-运行一下看看"><a href="#1-3-运行一下看看" class="headerlink" title="1.3.运行一下看看"></a>1.3.运行一下看看</h2><p><img src="/images/day06/1540706914029.png" alt="1540706914029"></p>
<p>在package.json文件中有scripts启动脚本配置，可以输入命令：<code>npm run dev</code>或者<code>npm start</code></p>
<p><img src="/images/day06/1530374954209.png" alt="1530374954209"></p>
<p>发现默认的端口是9001。访问：<a href="http://localhost:9001" target="_blank" rel="noopener">http://localhost:9001</a></p>
<p>会自动进行跳转：</p>
<p><img src="/images/day06/1530375152204.png" alt="1525958950616"></p>
<h2 id="1-4-目录结构"><a href="#1-4-目录结构" class="headerlink" title="1.4.目录结构"></a>1.4.目录结构</h2><p> <img src="/images/day06/1525962755237.png" alt="1525962755237"></p>
<p>webpack：是一个现代 JavaScript 应用程序的<em>静态模块打包器(module bundler)</em>。并且提供了前端项目的热部署插件。</p>
<h2 id="1-5-调用关系"><a href="#1-5-调用关系" class="headerlink" title="1.5.调用关系"></a>1.5.调用关系</h2><p>我们最主要理清index.html、main.js、App.vue之间的关系：</p>
<p><img src="/images/day06/1525964023585.png" alt="1525964023585"></p>
<p>理一下：</p>
<ul>
<li>index.html：html模板文件。定义了空的<code>div</code>，其id为<code>app</code>。</li>
<li>main.js：<strong>实例化vue对象</strong>，并且通过id选择器绑定到index.html的div中，因此<strong>main.js的内容都将在index.html的div中显示</strong>。main.js中使用了App组件，即App.vue，也就是说index.html中最终展现的是App.vue中的内容。index.html引用它之后，就拥有了vue的内容（包括组件、样式等），所以，main.js也是<strong>webpack打包的入口</strong>。</li>
<li>index.js：定义请求路径和组件的映射关系。相当于之前的<code>&lt;vue-router&gt;</code></li>
<li>App.vue中也没有内容，而是定义了vue-router的锚点：<code>&lt;router-view&gt;</code>,我们之前讲过，vue-router路由后的组件将会在锚点展示。</li>
<li>最终结论：<strong>一切路由后的内容都将通过App.vue在index.html中显示。</strong></li>
<li>访问流程：用户在浏览器输入路径，例如：<a href="http://localhost:9001/#/item/brand" target="_blank" rel="noopener">http://localhost:9001/#/item/brand</a> –&gt; index.js(/item/brand路径对应pages/item/Brand.vue组件) –&gt; 该组件显示在App.vue的锚点位置 –&gt; main.js使用了App.vue组件，并把该组件渲染在index.html文件中（id为“app”的div中）</li>
</ul>
<p><img src="/images/day06/1543399927909.png" alt="1543399927909"></p>
<h1 id="2-Vuetify框架"><a href="#2-Vuetify框架" class="headerlink" title="2.Vuetify框架"></a>2.Vuetify框架</h1><h2 id="2-1-为什么要学习UI框架"><a href="#2-1-为什么要学习UI框架" class="headerlink" title="2.1.为什么要学习UI框架"></a>2.1.为什么要学习UI框架</h2><p>Vue虽然会帮我们进行视图的渲染，但样式还是由我们自己来完成。这显然不是我们的强项，因此后端开发人员一般都喜欢使用一些现成的UI组件，拿来即用，常见的例如：</p>
<ul>
<li>BootStrap</li>
<li>LayUI</li>
<li>EasyUI</li>
<li>ZUI</li>
</ul>
<p>然而这些UI组件的基因天生与Vue不合，因为他们更多的是利用DOM操作，借助于jQuery实现，而不是MVVM的思想。</p>
<p>而目前与Vue吻合的UI框架也非常的多，国内比较知名的如：</p>
<ul>
<li>element-ui：饿了么出品</li>
<li>i-view：某公司出品</li>
</ul>
<p>然而我们都不用，我们今天推荐的是一款国外的框架：Vuetify</p>
<p>官方网站：<a href="https://vuetifyjs.com/zh-Hans/" target="_blank" rel="noopener">https://vuetifyjs.com/zh-Hans/</a></p>
<p><img src="/images/day06/1525960652724.png" alt="1525960652724"></p>
<h2 id="2-2-为什么是Vuetify"><a href="#2-2-为什么是Vuetify" class="headerlink" title="2.2.为什么是Vuetify"></a>2.2.为什么是Vuetify</h2><p>有中国的为什么还要用外国的？原因如下：</p>
<ul>
<li>Vuetify几乎不需要任何CSS代码，而element-ui许多布局样式需要我们来编写</li>
<li>Vuetify从底层构建起来的语义化组件。简单易学，容易记住。</li>
<li>Vuetify基于Material Design（谷歌推出的多平台设计规范），更加美观，动画效果酷炫，且风格统一</li>
</ul>
<p>这是官网的说明：</p>
<p><img src="/images/day06/1530555978248.png" alt="1530555978248"></p>
<p>缺陷：</p>
<ul>
<li>目前官网虽然有中文文档，但因为翻译问题，几乎不太能看。</li>
</ul>
<h2 id="2-3-怎么用？"><a href="#2-3-怎么用？" class="headerlink" title="2.3.怎么用？"></a>2.3.怎么用？</h2><p>基于官方网站的文档进行学习：</p>
<p><img src="/images/day06/1525960312939.png" alt="1525960312939"></p>
<p>我们重点关注<code>UI components</code>即可，里面有大量的UI组件，我们要用的时候再查看，不用现在学习，先看下有什么：</p>
<p> <img src="/images/day06/1525961862771.png" alt="1525961862771"></p>
<p> <img src="/images/day06/1525961875288.png" alt="1525961875288"></p>
<p>以后用到什么组件，就来查询即可。</p>
<h2 id="2-4-项目页面布局"><a href="#2-4-项目页面布局" class="headerlink" title="2.4.项目页面布局"></a>2.4.项目页面布局</h2><p>接下来我们一起看下页面布局。</p>
<p>Layout组件是我们的整个页面的布局组件：</p>
<p><img src="/images/day06/1530380040278.png" alt="1530380040278"></p>
<p>一个典型的三块布局。包含左，上，中三部分：</p>
<p> <img src="/images/day06/1525965779366.png" alt="1525965779366"></p>
<p>里面使用了Vuetify中的2个组件和一个布局元素：</p>
<ul>
<li><p><code>v-navigation-drawer</code> ：导航抽屉，主要用于容纳应用程序中的页面的导航链接。 </p>
<p><img src="/images/day06/1532577155616.png" alt="1532577155616"></p>
</li>
<li><p><code>v-toolbar</code>：工具栏通常是网站导航的主要途径。可以与导航抽屉一起很好地工作，动态选择是否打开导航抽屉，实现可伸缩的侧边栏。</p>
<p><img src="/images/day06/1530380292558.png" alt="1530380292558"></p>
</li>
<li><p><code>v-content</code>：并不是一个组件，而是标记页面布局的元素。可以根据您指定的<strong>app</strong>组件的结构动态调整大小，使得您可以创建高度可定制的组件。</p>
</li>
</ul>
<p>那么问题来了：<code>v-content</code>中的内容来自哪里？</p>
<p><img src="/images/day06/1525966180568.png" alt="1525966180568"></p>
<ul>
<li>Layout映射的路径是<code>/</code></li>
<li>除了Login以外的所有组件，都是定义在Layout的children属性，并且路径都是<code>/</code>的下面</li>
<li>因此当路由到子组件时，会在Layout中定义的锚点中显示。</li>
<li>并且Layout中的其它部分不会变化，这就实现了布局的共享。</li>
</ul>
<h1 id="3-使用域名访问本地项目"><a href="#3-使用域名访问本地项目" class="headerlink" title="3.使用域名访问本地项目"></a>3.使用域名访问本地项目</h1><h2 id="3-1-统一环境"><a href="#3-1-统一环境" class="headerlink" title="3.1.统一环境"></a>3.1.统一环境</h2><p>我们现在访问页面使用的是：<a href="http://localhost:9001" target="_blank" rel="noopener">http://localhost:9001</a></p>
<p>有没有什么问题？</p>
<p>实际开发中，会有不同的环境：</p>
<ul>
<li>开发环境：自己的电脑</li>
<li>测试环境：提供给测试人员使用的环境</li>
<li>预发布环境：数据是和生成环境的数据一致，运行最新的项目代码进去测试</li>
<li>生产环境：项目最终发布上线的环境</li>
</ul>
<p>如果不同环境使用不同的ip去访问，可能会出现一些问题。为了保证所有环境的一致，我们会在各种环境下都使用域名来访问。</p>
<p>我们将使用以下域名：</p>
<ul>
<li>主域名是：<a href="http://www.leyou.com，leyou.com" target="_blank" rel="noopener">www.leyou.com，leyou.com</a> </li>
<li>管理系统域名：manage.leyou.com</li>
<li>网关域名：api.leyou.com</li>
<li>…</li>
</ul>
<p>但是最终，我们希望这些域名指向的还是我们本机的某个端口。</p>
<p>那么，当我们在浏览器输入一个域名时，浏览器是如何找到对应服务的ip和端口的呢？</p>
<h2 id="3-2-域名解析"><a href="#3-2-域名解析" class="headerlink" title="3.2.域名解析"></a>3.2.域名解析</h2><p>一个域名一定会被解析为一个或多个ip。这一般会包含两步：</p>
<ul>
<li><p>本地域名解析</p>
<p>浏览器会首先在本机的hosts文件中查找域名映射的IP地址，如果查找到就返回IP ，没找到则进行域名服务器解析，一般本地解析都会失败，因为默认这个文件是空的。</p>
<ul>
<li>Windows下的hosts文件地址：C:/Windows/System32/drivers/etc/hosts</li>
<li>Linux下的hosts文件所在路径： /etc/hosts </li>
</ul>
<p>样式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># My hosts</span><br><span class="line">127.0.0.1 localhost</span><br></pre></td></tr></table></figure>
</li>
<li><p>域名服务器解析</p>
<p>本地解析失败，才会进行域名服务器解析，域名服务器就是网络中的一台计算机，里面记录了所有注册备案的域名和ip映射关系，一般只要域名是正确的，并且备案通过，一定能找到。</p>
</li>
</ul>
<h2 id="3-3-解决域名解析问题"><a href="#3-3-解决域名解析问题" class="headerlink" title="3.3.解决域名解析问题"></a>3.3.解决域名解析问题</h2><p>我们不可能去购买一个域名，因此我们可以伪造本地的hosts文件，实现对域名的解析。修改本地的host为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 api.leyou.com</span><br><span class="line">127.0.0.1 manage.leyou.com</span><br></pre></td></tr></table></figure>

<p>这样就实现了域名的关系映射了。</p>
<p>每次在C盘寻找hosts文件并修改是非常麻烦的，给大家推荐一个快捷修改host的工具，在课前资料中可以找到：</p>
<p><img src="/images/day06/1530556073565.png" alt="1530556073565"></p>
<p>解压，运行exe文件，效果：</p>
<p><img src="/images/day06/1530382550630.png" alt="1530382550630"></p>
<p>我们添加了两个映射关系（中间用空格隔开）：</p>
<ul>
<li>127.0.0.1 api.leyou.com ：我们的网关Zuul</li>
<li>127.0.0.1 manage.leyou.com：我们的后台系统地址</li>
</ul>
<p>现在，ping一下域名试试是否畅通：</p>
<p><img src="/images/day06/1530382601757.png" alt="1530382601757"></p>
<p>OK！</p>
<p>通过域名访问：</p>
<p><img src="/images/day06/1530383586463.png" alt="1530383586463"></p>
<p>原因：我们配置了项目访问的路径，虽然manage.leyou.com映射的ip也是127.0.0.1，但是webpack会验证host是否符合配置。</p>
<p><img src="/images/day06/1530383612716.png" alt="1530383612716"></p>
<p>在webpack.dev.conf.js中取消host验证：<code>disableHostCheck: true</code></p>
<p><img src="/images/day06/1530383927461.png" alt="1530383927461"></p>
<p>重新执行<code>npm run dev</code>，刷新浏览器：</p>
<p><img src="/images/day06/1532578408206.png" alt="1532578408206"></p>
<p>OK！</p>
<h2 id="3-4-nginx解决端口问题"><a href="#3-4-nginx解决端口问题" class="headerlink" title="3.4.nginx解决端口问题"></a>3.4.nginx解决端口问题</h2><p>域名问题解决了，但是现在要访问后台页面，还得自己加上端口：<code>http://manage.taotao.com:9001</code>。</p>
<p>这就不够优雅了。我们希望的是直接域名访问：<code>http://manage.taotao.com</code>。这种情况下端口默认是80，如何才能把请求转移到9001端口呢？</p>
<p>这里就要用到反向代理工具：Nginx</p>
<h3 id="3-4-1-什么是Nginx"><a href="#3-4-1-什么是Nginx" class="headerlink" title="3.4.1.什么是Nginx"></a>3.4.1.什么是Nginx</h3><p> <img src="/images/day06/1526187409033.png" alt="1526187409033"></p>
<p>nginx可以作为web服务器，但更多的时候，我们把它作为网关，因为它具备网关必备的功能：</p>
<ul>
<li>反向代理</li>
<li>负载均衡</li>
<li>动态路由</li>
<li>请求过滤</li>
</ul>
<h3 id="3-4-2-nginx作为web服务器"><a href="#3-4-2-nginx作为web服务器" class="headerlink" title="3.4.2.nginx作为web服务器"></a>3.4.2.nginx作为web服务器</h3><p>Web服务器分2类：</p>
<ul>
<li>web应用服务器，如：<ul>
<li>tomcat </li>
<li>resin</li>
<li>jetty</li>
</ul>
</li>
<li>web服务器，如：<ul>
<li>Apache 服务器 </li>
<li>Nginx</li>
<li>IIS  </li>
</ul>
</li>
</ul>
<p>区分：web服务器不能解析jsp等页面，只能处理js、css、html等静态资源。<br>并发：web服务器的并发能力远高于web应用服务器。</p>
<h3 id="3-4-3-nginx作为反向代理"><a href="#3-4-3-nginx作为反向代理" class="headerlink" title="3.4.3.nginx作为反向代理"></a>3.4.3.nginx作为反向代理</h3><p>什么是反向代理？</p>
<ul>
<li>代理：通过客户机的配置，实现让一台服务器代理客户机，客户的所有请求都交给代理服务器处理。</li>
<li>反向代理：用一台服务器，代理真实服务器，用户访问时，不再是访问真实服务器，而是代理服务器。</li>
</ul>
<p>nginx可以当做反向代理服务器来使用：</p>
<ul>
<li>我们需要提前在nginx中配置好反向代理的规则，不同的请求，交给不同的真实服务器处理</li>
<li>当请求到达nginx，nginx会根据已经定义的规则进行请求的转发，从而实现路由功能</li>
</ul>
<p>利用反向代理，就可以解决我们前面所说的端口问题，如图</p>
<p><img src="/images/day06/1526016663674.png" alt="1526016663674"></p>
<h3 id="3-4-4-安装和使用"><a href="#3-4-4-安装和使用" class="headerlink" title="3.4.4.安装和使用"></a>3.4.4.安装和使用</h3><blockquote>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3></blockquote>
<p>安装非常简单，把课前资料提供的nginx直接解压即可，绿色免安装，舒服！</p>
<p><img src="/images/day06/0C36B84E.gif" alt="img"> </p>
<p>我们在本地安装一台nginx：</p>
<p><img src="/images/day06/1530556268445.png" alt="1530556268445"></p>
<p>解压后，目录结构：</p>
<p><img src="/images/day06/1530384792790.png" alt="1530384792790"></p>
<ol>
<li>conf：配置目录</li>
<li>contrib：第三方依赖</li>
<li>html：默认的静态资源目录，类似于tomcat的webapps</li>
<li>logs：日志目录</li>
<li>nginx.exe：启动程序。可双击运行，但不建议这么做。</li>
</ol>
<blockquote>
<h3 id="反向代理配置"><a href="#反向代理配置" class="headerlink" title="反向代理配置"></a>反向代理配置</h3></blockquote>
<p>示例：</p>
<p> <img src="/images/day06/1526188831504.png" alt="1526188831504"></p>
<p>nginx中的每个server就是一个反向代理配置，可以有多个server</p>
<p>完整配置：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#user  nobody;</span></span><br><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">   </span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">gzip</span>  <span class="literal">on</span>;</span><br><span class="line">	<span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  manage.leyou.com;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-Server <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">			<span class="attribute">proxy_pass</span> http://127.0.0.1:9001;</span><br><span class="line">			<span class="attribute">proxy_connect_timeout</span> <span class="number">600</span>;</span><br><span class="line">			<span class="attribute">proxy_read_timeout</span> <span class="number">600</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  api.leyou.com;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-Server <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">			<span class="attribute">proxy_pass</span> http://127.0.0.1:10010;</span><br><span class="line">			<span class="attribute">proxy_connect_timeout</span> <span class="number">600</span>;</span><br><span class="line">			<span class="attribute">proxy_read_timeout</span> <span class="number">600</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3></blockquote>
<p>nginx可以通过命令行来启动，操作命令：</p>
<ul>
<li>启动：<code>start nginx.exe</code></li>
<li>停止：<code>nginx.exe -s stop</code></li>
<li>重新加载：<code>nginx.exe -s reload</code></li>
</ul>
<p>启动过程会闪烁一下，启动成功后，任务管理器中会有两个nginx进程：</p>
<p> <img src="/images/day06/1532579488518.png" alt="1532579488518"></p>
<h2 id="3-5-测试"><a href="#3-5-测试" class="headerlink" title="3.5.测试"></a>3.5.测试</h2><p>启动nginx，然后用域名访问后台管理系统：</p>
<p><img src="/images/day06/1530385593052.png" alt="1530385593052"></p>
<p>现在实现了域名访问网站了，中间的流程是怎样的呢？</p>
<p><img src="/images/day06/1526189945180.png" alt="1526189945180"></p>
<ol>
<li><p>浏览器准备发起请求，访问<a href="http://mamage.leyou.com，但需要进行域名解析" target="_blank" rel="noopener">http://mamage.leyou.com，但需要进行域名解析</a></p>
</li>
<li><p>优先进行本地域名解析，因为我们修改了hosts，所以解析成功，得到地址：127.0.0.1</p>
</li>
<li><p>请求被发往解析得到的ip，并且默认使用80端口：<a href="http://127.0.0.1:80" target="_blank" rel="noopener">http://127.0.0.1:80</a></p>
<p>本机的nginx一直监听80端口，因此捕获这个请求</p>
</li>
<li><p>nginx中配置了反向代理规则，将manage.leyou.com代理到127.0.0.1:9001，因此请求被转发</p>
</li>
<li><p>后台系统的webpack server监听的端口是9001，得到请求并处理，完成后将响应返回到nginx</p>
</li>
<li><p>nginx将得到的结果返回到浏览器</p>
</li>
</ol>
<h1 id="4-实现商品分类查询"><a href="#4-实现商品分类查询" class="headerlink" title="4.实现商品分类查询"></a>4.实现商品分类查询</h1><p>商城的核心自然是商品，而商品多了以后，肯定要进行分类，并且不同的商品会有不同的品牌信息，我们需要依次去完成：商品分类、品牌、商品的开发。</p>
<h2 id="4-1-导入数据"><a href="#4-1-导入数据" class="headerlink" title="4.1.导入数据"></a>4.1.导入数据</h2><p>首先导入课前资料提供的sql：</p>
<p><img src="/images/day06/1530556389224.png" alt="1530556389224"></p>
<p>我们先看商品分类表：</p>
<p> <img src="/images/day06/1525999774439.png" alt="1525999774439"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `tb_category` (</span><br><span class="line">  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &apos;类目id&apos;,</span><br><span class="line">  `name` varchar(20) NOT NULL COMMENT &apos;类目名称&apos;,</span><br><span class="line">  `parent_id` bigint(20) NOT NULL COMMENT &apos;父类目id,顶级类目填0&apos;,</span><br><span class="line">  `is_parent` tinyint(1) NOT NULL COMMENT &apos;是否为父节点，0为否，1为是&apos;,</span><br><span class="line">  `sort` int(4) NOT NULL COMMENT &apos;排序指数，越小越靠前&apos;,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  KEY `key_parent_id` (`parent_id`) USING BTREE</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=1424 DEFAULT CHARSET=utf8 COMMENT=&apos;商品类目表，类目和商品(spu)是一对多关系，类目与品牌是多对多关系&apos;;</span><br></pre></td></tr></table></figure>

<p>因为商品分类会有层级关系，因此这里我们加入了<code>parent_id</code>字段，对本表中的其它分类进行自关联。</p>
<h2 id="4-2-实现功能"><a href="#4-2-实现功能" class="headerlink" title="4.2.实现功能"></a>4.2.实现功能</h2><p>在浏览器页面点击“分类管理”菜单：</p>
<p><img src="/images/day06/1545220121941.png" alt="1545220121941"></p>
<p>根据这个路由路径到路由文件（src/route/index.js），可以定位到分类管理页面：</p>
<p><img src="/images/day06/1545220316442.png" alt="1545220316442"></p>
<p>由路由文件知，页面是src/pages/item/Category.vue</p>
<p><img src="/images/day06/1545220394460.png" alt="1545220394460"></p>
<p>商品分类使用了树状结构，而这种结构的组件vuetify并没有为我们提供，这里自定义了一个树状组件。不要求实现或者查询组件的实现，只要求可以参照文档使用该组件即可：</p>
<p><img src="/images/day06/1545219777406.png" alt="1545219777406"></p>
<h3 id="4-2-1-url异步请求"><a href="#4-2-1-url异步请求" class="headerlink" title="4.2.1.url异步请求"></a>4.2.1.url异步请求</h3><p>点击商品管理下的分类管理子菜单，在浏览器控制台可以看到：</p>
<p><img src="/images/day06/1530427294644.png" alt="1530427294644"></p>
<p>页面中没有，只是发起了一条请求：<a href="http://api.leyou.com/api/item/category/list?pid=0" target="_blank" rel="noopener">http://api.leyou.com/api/item/category/list?pid=0</a> </p>
<p>大家可能会觉得很奇怪，我们明明是使用的相对路径：/item/category/list，讲道理发起的请求地址应该是：</p>
<p><a href="http://manage.leyou.com/item/category/list" target="_blank" rel="noopener">http://manage.leyou.com/item/category/list</a></p>
<p>但实际却是：</p>
<p><a href="http://api.leyou.com/api/item/category/list?pid=0" target="_blank" rel="noopener">http://api.leyou.com/api/item/category/list?pid=0</a> </p>
<p>这是因为，我们有一个全局的配置文件，对所有的请求路径进行了约定：</p>
<p><img src="/images/day06/1530427514123.png" alt="1530427514123"></p>
<p>路径是<a href="http://api.leyou.com，并且默认加上了/api的前缀，这恰好与我们的网关设置匹配，我们只需要把地址改成网关的地址即可,因为我们使用了nginx反向代理，这里可以写域名。" target="_blank" rel="noopener">http://api.leyou.com，并且默认加上了/api的前缀，这恰好与我们的网关设置匹配，我们只需要把地址改成网关的地址即可,因为我们使用了nginx反向代理，这里可以写域名。</a></p>
<p>接下来，我们要做的事情就是编写后台接口，返回对应的数据即可。</p>
<h3 id="4-2-2-实体类"><a href="#4-2-2-实体类" class="headerlink" title="4.2.2.实体类"></a>4.2.2.实体类</h3><p>在<code>leyou-item-interface</code>中添加category实体类：</p>
<p> <img src="/images/day06/1530444682670.png" alt="1530444682670"></p>
<p>内容：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Table</span>(name=<span class="string">"tb_category"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Category</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="meta">@GeneratedValue</span>(strategy=GenerationType.IDENTITY)</span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> Long parentId;</span><br><span class="line">	<span class="keyword">private</span> Boolean isParent; <span class="comment">// 注意isParent生成的getter和setter方法需要手动加上Is</span></span><br><span class="line">	<span class="keyword">private</span> Integer sort;</span><br><span class="line">	<span class="comment">// getter和setter略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要注意的是，这里要用到jpa的注解，因此我们在<code>leyou-item-iterface</code>中添加jpa依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.persistence<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>persistence-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-3-controller"><a href="#4-2-3-controller" class="headerlink" title="4.2.3.controller"></a>4.2.3.controller</h3><p>编写一个controller一般需要知道四个内容：</p>
<ul>
<li>请求方式：决定我们用GetMapping还是PostMapping</li>
<li>请求路径：决定映射路径</li>
<li>请求参数：决定方法的参数</li>
<li>返回值结果：决定方法的返回值</li>
</ul>
<p>在刚才页面发起的请求中，我们就能得到绝大多数信息：</p>
<p><img src="/images/day06/1530445885707.png" alt="1530445885707"></p>
<ul>
<li><p>请求方式：Get，插叙肯定是get请求</p>
</li>
<li><p>请求路径：/api/item/category/list。其中/api是网关前缀，/item是网关的路由映射，真实的路径应该是/category/list</p>
</li>
<li><p>请求参数：pid=0，根据tree组件的说明，应该是父节点的id，第一次查询为0，那就是查询一级类目</p>
</li>
<li><p>返回结果：？？</p>
<p>根据前面tree组件的用法我们知道，返回的应该是json数组：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123; </span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">74</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"手机"</span>,</span><br><span class="line">        <span class="attr">"parentId"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"isParent"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"sort"</span>: <span class="number">2</span></span><br><span class="line">	&#125;,</span><br><span class="line">     &#123; </span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">75</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"家用电器"</span>,</span><br><span class="line">        <span class="attr">"parentId"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"isParent"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"sort"</span>: <span class="number">3</span></span><br><span class="line">	&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>对应的java类型可以是List集合，里面的元素就是类目对象了。也就是<code>List&lt;Category&gt;</code></p>
</li>
</ul>
<p>添加Controller：</p>
<p> <img src="/images/day06/1530450599897.png" alt="1530450599897"></p>
<p>controller代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"category"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CategoryService categoryService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据父id查询子节点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"list"</span>)</span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;List&lt;Category&gt;&gt; queryCategoriesByPid(<span class="meta">@RequestParam</span>(<span class="string">"pid"</span>) Long pid) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (pid == <span class="keyword">null</span> || pid.longValue() &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 响应400，相当于ResponseEntity.status(HttpStatus.BAD_REQUEST).build();</span></span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.badRequest().build();</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Category&gt; categories = <span class="keyword">this</span>.categoryService.queryCategoriesByPid(pid);</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(categories)) &#123;</span><br><span class="line">            <span class="comment">// 响应404</span></span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.notFound().build();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(categories);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-4-service"><a href="#4-2-4-service" class="headerlink" title="4.2.4.service"></a>4.2.4.service</h3><p>一般service层我们会定义接口和实现类，不过这里我们就偷懒一下，直接写实现类了：</p>
<p> <img src="/images/day06/1530450744567.png" alt="1530450744567"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CategoryMapper categoryMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据parentId查询子类目</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">queryCategoriesByPid</span><span class="params">(Long pid)</span> </span>&#123;</span><br><span class="line">        Category record = <span class="keyword">new</span> Category();</span><br><span class="line">        record.setParentId(pid);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.categoryMapper.select(record);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-5-mapper"><a href="#4-2-5-mapper" class="headerlink" title="4.2.5.mapper"></a>4.2.5.mapper</h3><p>我们使用通用mapper来简化开发：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CategoryMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">Category</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要注意，我们并没有在mapper接口上声明@Mapper注解，那么mybatis如何才能找到接口呢？</p>
<p>我们在启动类上添加一个扫描包功能：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@MapperScan</span>(<span class="string">"com.leyou.item.mapper"</span>) <span class="comment">// mapper接口的包扫描</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LeyouItemServiceApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(LeyouItemServiceApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-6-启动并测试"><a href="#4-2-6-启动并测试" class="headerlink" title="4.2.6.启动并测试"></a>4.2.6.启动并测试</h3><p>我们不经过网关，直接访问：<a href="http://localhost:8081/category/list" target="_blank" rel="noopener">http://localhost:8081/category/list</a></p>
<p><img src="/images/day06/1530455133230.png" alt="1530455133230"></p>
<p>然后试试网关是否畅通：<a href="http://api.leyou.com/api/item/category/list" target="_blank" rel="noopener">http://api.leyou.com/api/item/category/list</a></p>
<p><img src="/images/day06/1530455291468.png" alt="1530455291468"></p>
<p>一切OK！</p>
<p>然后刷新后台管理页面查看：</p>
<p><img src="/images/day06/1530455437899.png" alt="1530455437899"></p>
<p>发现报错了！</p>
<p>浏览器直接访问没事，但是这里却报错，什么原因？</p>
<p>这其实是浏览器的同源策略造成的跨域问题。</p>
<h1 id="5-跨域问题"><a href="#5-跨域问题" class="headerlink" title="5.跨域问题"></a>5.跨域问题</h1><p>跨域：浏览器对于javascript的同源策略的限制 。</p>
<p>以下情况都属于跨域：</p>
<table>
<thead>
<tr>
<th>跨域原因说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>域名不同</td>
<td><code>www.jd.com</code> 与 <code>www.taobao.com</code></td>
</tr>
<tr>
<td>域名相同，端口不同</td>
<td><code>www.jd.com:8080</code> 与 <code>www.jd.com:8081</code></td>
</tr>
<tr>
<td>二级域名不同</td>
<td><code>item.jd.com</code> 与 <code>miaosha.jd.com</code></td>
</tr>
</tbody></table>
<p>如果<strong>域名和端口都相同，但是请求路径不同</strong>，不属于跨域，如：</p>
<p><code>www.jd.com/item</code> </p>
<p><code>www.jd.com/goods</code></p>
<p>http和https也属于跨域</p>
<p>而我们刚才是从<code>manage.leyou.com</code>去访问<code>api.leyou.com</code>，这属于二级域名不同，跨域了。</p>
<h2 id="5-1-为什么有跨域问题？"><a href="#5-1-为什么有跨域问题？" class="headerlink" title="5.1.为什么有跨域问题？"></a>5.1.为什么有跨域问题？</h2><p>跨域不一定都会有跨域问题。</p>
<p>因为跨域问题是浏览器对于ajax请求的一种安全限制：<strong>一个页面发起的ajax请求，只能是与当前页域名相同的路径</strong>，这能有效的阻止跨站攻击。</p>
<p>因此：<strong>跨域问题 是针对ajax的一种限制</strong>。</p>
<p>但是这却给我们的开发带来了不便，而且在实际生产环境中，肯定会有很多台服务器之间交互，地址和端口都可能不同，怎么办？</p>
<h2 id="5-2-解决跨域问题的方案"><a href="#5-2-解决跨域问题的方案" class="headerlink" title="5.2.解决跨域问题的方案"></a>5.2.解决跨域问题的方案</h2><p>目前比较常用的跨域解决方案有3种：</p>
<ul>
<li><p>Jsonp</p>
<p>最早的解决方案，利用script标签可以跨域的原理实现。</p>
<p>限制：</p>
<ul>
<li>需要服务的支持</li>
<li>只能发起GET请求</li>
</ul>
</li>
<li><p>nginx反向代理</p>
<p>思路是：利用nginx把跨域反向代理为不跨域，支持各种请求方式</p>
<p>缺点：需要在nginx进行额外配置，语义不清晰 </p>
</li>
<li><p>CORS</p>
<p>规范化的跨域请求解决方案，安全可靠。</p>
<p>优势：</p>
<ul>
<li>在服务端进行控制是否允许跨域，可自定义规则</li>
<li>支持各种请求方式</li>
</ul>
<p>缺点：</p>
<ul>
<li>会产生额外的请求</li>
</ul>
</li>
</ul>
<p>我们这里会采用cors的跨域方案。</p>
<h2 id="5-3-cors解决跨域"><a href="#5-3-cors解决跨域" class="headerlink" title="5.3.cors解决跨域"></a>5.3.cors解决跨域</h2><h3 id="5-3-1-什么是cors"><a href="#5-3-1-什么是cors" class="headerlink" title="5.3.1.什么是cors"></a>5.3.1.什么是cors</h3><p>CORS是一个W3C标准，全称是”跨域资源共享”（Cross-origin resource sharing）。</p>
<p>它允许浏览器向跨源服务器，发出<a href="http://www.ruanyifeng.com/blog/2012/09/xmlhttprequest_level_2.html" target="_blank" rel="noopener"><code>XMLHttpRequest</code></a>请求，从而克服了AJAX只能<a href="http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html" target="_blank" rel="noopener">同源</a>使用的限制。</p>
<p>CORS需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，IE浏览器不能低于IE10。</p>
<ul>
<li><p>浏览器端：</p>
<p>目前，所有浏览器都支持该功能（IE10以下不行）。整个CORS通信过程，都是浏览器自动完成，不需要用户参与。</p>
</li>
<li><p>服务端：</p>
<p>CORS通信与AJAX没有任何差别，因此你不需要改变以前的业务逻辑。只不过，浏览器会在请求中携带一些头信息，我们需要以此判断是否允许其跨域，然后在响应头中加入一些信息即可。这一般通过过滤器完成即可。</p>
</li>
</ul>
<h3 id="5-3-2-原理有点复杂"><a href="#5-3-2-原理有点复杂" class="headerlink" title="5.3.2.原理有点复杂"></a>5.3.2.原理有点复杂</h3><p>浏览器会将ajax请求分为两类，其处理方案略有差异：简单请求、特殊请求。</p>
<h4 id="5-3-2-1-简单请求"><a href="#5-3-2-1-简单请求" class="headerlink" title="5.3.2.1.简单请求"></a>5.3.2.1.简单请求</h4><p>只要同时满足以下两大条件，就属于简单请求。：</p>
<p>（1) 请求方法是以下三种方法之一：</p>
<ul>
<li>HEAD</li>
<li>GET</li>
<li>POST</li>
</ul>
<p>（2）HTTP的头信息不超出以下几种字段：</p>
<ul>
<li>Accept</li>
<li>Accept-Language</li>
<li>Content-Language</li>
<li>Last-Event-ID</li>
<li>Content-Type：只限于三个值<code>application/x-www-form-urlencoded</code>、<code>multipart/form-data</code>、<code>text/plain</code></li>
</ul>
<p>当浏览器发现发起的ajax请求是简单请求时，会在请求头中携带一个字段：<code>Origin</code>.</p>
<p><img src="/images/day06/1530460311064.png" alt="1530460311064"></p>
<p>Origin中会指出当前请求属于哪个域（协议+域名+端口）。服务会根据这个值决定是否允许其跨域。</p>
<p>如果服务器允许跨域，需要在返回的响应头中携带下面信息：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Access-Control-Allow-Origin</span>: http://manage.leyou.com</span><br><span class="line"><span class="attribute">Access-Control-Allow-Credentials</span>: true</span><br><span class="line"><span class="attribute">Content-Type</span>: text/html; charset=utf-8</span><br></pre></td></tr></table></figure>

<ul>
<li>Access-Control-Allow-Origin：可接受的域，是一个具体域名或者*（代表任意域名）</li>
<li>Access-Control-Allow-Credentials：是否允许携带cookie，默认情况下，cors不会携带cookie，除非这个值是true</li>
</ul>
<blockquote>
<p>有关cookie：</p>
</blockquote>
<p>要想操作cookie，需要满足3个条件：</p>
<ul>
<li>服务的响应头中需要携带Access-Control-Allow-Credentials并且为true。</li>
<li>浏览器发起ajax需要指定withCredentials 为true</li>
<li>响应头中的Access-Control-Allow-Origin一定不能为*，必须是指定的域名</li>
</ul>
<h4 id="5-3-2-2-特殊请求"><a href="#5-3-2-2-特殊请求" class="headerlink" title="5.3.2.2.特殊请求"></a>5.3.2.2.特殊请求</h4><p>不符合简单请求的条件，会被浏览器判定为特殊请求,，例如请求方式为PUT。</p>
<blockquote>
<p>预检请求</p>
</blockquote>
<p>特殊请求会在正式通信之前，增加一次HTTP查询请求，称为”预检”请求（preflight）。</p>
<p>浏览器先询问服务器，当前网页所在的域名是否在服务器的许可名单之中，以及可以使用哪些HTTP动词和头信息字段。只有得到肯定答复，浏览器才会发出正式的<code>XMLHttpRequest</code>请求，否则就报错。</p>
<p>一个“预检”请求的样板：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">OPTIONS</span> <span class="string">/cors</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Origin</span>: http://manage.leyou.com</span><br><span class="line"><span class="attribute">Access-Control-Request-Method</span>: PUT</span><br><span class="line"><span class="attribute">Access-Control-Request-Headers</span>: X-Custom-Header</span><br><span class="line"><span class="attribute">Host</span>: api.leyou.com</span><br><span class="line"><span class="attribute">Accept-Language</span>: en-US</span><br><span class="line"><span class="attribute">Connection</span>: keep-alive</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0...</span><br></pre></td></tr></table></figure>

<p>与简单请求相比，除了Origin以外，多了两个头：</p>
<ul>
<li>Access-Control-Request-Method：接下来会用到的请求方式，比如PUT</li>
<li>Access-Control-Request-Headers：会额外用到的头信息</li>
</ul>
<blockquote>
<p>预检请求的响应</p>
</blockquote>
<p>服务的收到预检请求，如果许可跨域，会发出响应：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Date</span>: Mon, 01 Dec 2008 01:15:39 GMT</span><br><span class="line"><span class="attribute">Server</span>: Apache/2.0.61 (Unix)</span><br><span class="line"><span class="attribute">Access-Control-Allow-Origin</span>: http://manage.leyou.com</span><br><span class="line"><span class="attribute">Access-Control-Allow-Credentials</span>: true</span><br><span class="line"><span class="attribute">Access-Control-Allow-Methods</span>: GET, POST, PUT</span><br><span class="line"><span class="attribute">Access-Control-Allow-Headers</span>: X-Custom-Header</span><br><span class="line"><span class="attribute">Access-Control-Max-Age</span>: 1728000</span><br><span class="line"><span class="attribute">Content-Type</span>: text/html; charset=utf-8</span><br><span class="line"><span class="attribute">Content-Encoding</span>: gzip</span><br><span class="line"><span class="attribute">Content-Length</span>: 0</span><br><span class="line"><span class="attribute">Keep-Alive</span>: timeout=2, max=100</span><br><span class="line"><span class="attribute">Connection</span>: Keep-Alive</span><br><span class="line"><span class="attribute">Content-Type</span>: text/plain</span><br></pre></td></tr></table></figure>

<p>除了<code>Access-Control-Allow-Origin</code>和<code>Access-Control-Allow-Credentials</code>以外，这里又额外多出3个头：</p>
<ul>
<li>Access-Control-Allow-Methods：允许访问的方式</li>
<li>Access-Control-Allow-Headers：允许携带的头</li>
<li>Access-Control-Max-Age：本次许可的有效时长，单位是秒，<strong>过期之前的ajax请求就无需再次进行预检了</strong></li>
</ul>
<p>如果浏览器得到上述响应，则认定为可以跨域，后续就跟简单请求的处理是一样的了。</p>
<h3 id="5-3-3-实现非常简单"><a href="#5-3-3-实现非常简单" class="headerlink" title="5.3.3.实现非常简单"></a>5.3.3.实现非常简单</h3><p>虽然原理比较复杂，但是前面说过：</p>
<ul>
<li>浏览器端都有浏览器自动完成，我们无需操心</li>
<li>服务端可以通过拦截器统一实现，不必每次都去进行跨域判定的编写。</li>
</ul>
<p>事实上，SpringMVC已经帮我们写好了CORS的跨域过滤器：CorsFilter ,内部已经实现了刚才所讲的判定逻辑，我们直接用就好了。</p>
<p>在<code>leyou-gateway</code>中编写一个配置类，并且注册CorsFilter：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.CorsConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.UrlBasedCorsConfigurationSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.filter.CorsFilter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LeyouCorsConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CorsFilter <span class="title">corsFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1.添加CORS配置信息</span></span><br><span class="line">        CorsConfiguration config = <span class="keyword">new</span> CorsConfiguration();</span><br><span class="line">        <span class="comment">//1) 允许的域,不要写*，否则cookie就无法使用了</span></span><br><span class="line">        config.addAllowedOrigin(<span class="string">"http://manage.leyou.com"</span>);</span><br><span class="line">        <span class="comment">//2) 是否发送Cookie信息</span></span><br><span class="line">        config.setAllowCredentials(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//3) 允许的请求方式</span></span><br><span class="line">        config.addAllowedMethod(<span class="string">"OPTIONS"</span>);</span><br><span class="line">        config.addAllowedMethod(<span class="string">"HEAD"</span>);</span><br><span class="line">        config.addAllowedMethod(<span class="string">"GET"</span>);</span><br><span class="line">        config.addAllowedMethod(<span class="string">"PUT"</span>);</span><br><span class="line">        config.addAllowedMethod(<span class="string">"POST"</span>);</span><br><span class="line">        config.addAllowedMethod(<span class="string">"DELETE"</span>);</span><br><span class="line">        config.addAllowedMethod(<span class="string">"PATCH"</span>);</span><br><span class="line">        <span class="comment">// 4）允许的头信息</span></span><br><span class="line">        config.addAllowedHeader(<span class="string">"*"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.添加映射路径，我们拦截一切请求</span></span><br><span class="line">        UrlBasedCorsConfigurationSource configSource = <span class="keyword">new</span> UrlBasedCorsConfigurationSource();</span><br><span class="line">        configSource.registerCorsConfiguration(<span class="string">"/**"</span>, config);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.返回新的CorsFilter.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CorsFilter(configSource);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结构：</p>
<p> <img src="/images/day06/1530462650711.png" alt="1530462650711"></p>
<p>重启测试，访问正常：</p>
<p><img src="/images/day06/1530463010927.png" alt="1530463010927"></p>
<p>分类的增删改功能暂时就不做了，页面已经预留好了事件接口，有兴趣的同学可以完成一下。</p>
<h1 id="6-品牌的查询"><a href="#6-品牌的查询" class="headerlink" title="6.品牌的查询"></a>6.品牌的查询</h1><p>商品分类完成以后，自然轮到了品牌功能了。</p>
<p>先看看我们要实现的效果：</p>
<p><img src="/images/day06/1526021968036.png" alt="1526021968036"></p>
<p>点击“品牌管理”菜单：</p>
<p><img src="/images/day06/1545221218980.png" alt="1545221218980"></p>
<p>路由路径：/item/brand</p>
<p>根据路由文件知，对应的页面是：src/pages/item/Brand.vue</p>
<p>页面会发送如下请求：</p>
<p><img src="/images/day06/1543066995215.png" alt="1543066995215"></p>
<h2 id="6-1-后台提供查询接口"><a href="#6-1-后台提供查询接口" class="headerlink" title="6.1.后台提供查询接口"></a>6.1.后台提供查询接口</h2><p>前台页面已经准备好，接下来就是后台提供数据接口了。</p>
<h3 id="6-1-1-数据库表"><a href="#6-1-1-数据库表" class="headerlink" title="6.1.1.数据库表"></a>6.1.1.数据库表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `tb_brand` (</span><br><span class="line">  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &apos;品牌id&apos;,</span><br><span class="line">  `name` varchar(50) NOT NULL COMMENT &apos;品牌名称&apos;,</span><br><span class="line">  `image` varchar(200) DEFAULT &apos;&apos; COMMENT &apos;品牌图片地址&apos;,</span><br><span class="line">  `letter` char(1) DEFAULT &apos;&apos; COMMENT &apos;品牌的首字母&apos;,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=325400 DEFAULT CHARSET=utf8 COMMENT=&apos;品牌表，一个品牌下有多个商品（spu），一对多关系&apos;;</span><br></pre></td></tr></table></figure>

<p>简单的四个字段，不多解释。</p>
<p>这里需要注意的是，品牌和商品分类之间是多对多关系。因此我们有一张中间表，来维护两者间关系：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `tb_category_brand` (</span><br><span class="line">  `category_id` bigint(20) NOT NULL COMMENT &apos;商品类目id&apos;,</span><br><span class="line">  `brand_id` bigint(20) NOT NULL COMMENT &apos;品牌id&apos;,</span><br><span class="line">  PRIMARY KEY (`category_id`,`brand_id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=&apos;商品分类和品牌的中间表，两者是多对多关系&apos;;</span><br></pre></td></tr></table></figure>

<p>但是，你可能会发现，这张表中并<strong>没有设置外键约束</strong>，似乎与数据库的设计范式不符。为什么这么做？</p>
<ul>
<li>外键会严重影响数据库读写的效率</li>
<li>数据删除时会比较麻烦</li>
</ul>
<p>在电商行业，性能是非常重要的。我们宁可在代码中通过逻辑来维护表关系，也不设置外键。</p>
<h3 id="6-1-2-实体类"><a href="#6-1-2-实体类" class="headerlink" title="6.1.2.实体类"></a>6.1.2.实体类</h3><p> <img src="/images/day06/1530541070271.png" alt="1530541070271"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Table</span>(name = <span class="string">"tb_brand"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Brand</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;<span class="comment">// 品牌名称</span></span><br><span class="line">    <span class="keyword">private</span> String image;<span class="comment">// 品牌图片</span></span><br><span class="line">    <span class="keyword">private</span> Character letter;</span><br><span class="line">    <span class="comment">// getter setter 略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-1-3-mapper"><a href="#6-1-3-mapper" class="headerlink" title="6.1.3.mapper"></a>6.1.3.mapper</h3><p> <img src="/images/day06/1530541222679.png" alt="1530541222679"></p>
<p>通用mapper来简化开发：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BrandMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">Brand</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-1-4-controller"><a href="#6-1-4-controller" class="headerlink" title="6.1.4.controller"></a>6.1.4.controller</h3><p>编写controller先思考四个问题，参照前端页面的控制台</p>
<ul>
<li>请求方式：查询，肯定是Get</li>
<li>请求路径：分页查询，/brand/page</li>
<li>请求参数：根据我们刚才编写的页面，有分页功能，有排序功能，有搜索过滤功能，因此至少要有5个参数：<ul>
<li>page：当前页，int</li>
<li>rows：每页大小，int</li>
<li>sortBy：排序字段，String</li>
<li>desc：是否为降序，boolean</li>
<li>key：搜索关键词，String</li>
</ul>
</li>
<li>响应结果：分页结果一般至少需要两个数据<ul>
<li>total：总条数</li>
<li>items：当前页数据</li>
<li>totalPage：有些还需要总页数</li>
</ul>
</li>
</ul>
<p>这里我们封装一个类，来表示分页结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PageResult</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long total;<span class="comment">// 总条数</span></span><br><span class="line">    <span class="keyword">private</span> Integer totalPage;<span class="comment">// 总页数</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; items;<span class="comment">// 当前页数据</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PageResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PageResult</span><span class="params">(Long total, List&lt;T&gt; items)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.total = total;</span><br><span class="line">        <span class="keyword">this</span>.items = items;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PageResult</span><span class="params">(Long total, Long totalPage, List&lt;T&gt; items)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.total = total;</span><br><span class="line">        <span class="keyword">this</span>.totalPage = totalPage;</span><br><span class="line">        <span class="keyword">this</span>.items = items;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getTotal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> total;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTotal</span><span class="params">(Long total)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.total = total;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;T&gt; <span class="title">getItems</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> items;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setItems</span><span class="params">(List&lt;T&gt; items)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.items = items;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getTotalPage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> totalPage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTotalPage</span><span class="params">(Long totalPage)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.totalPage = totalPage;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>另外，这个PageResult以后可能在其它项目中也有需求，因此我们将其抽取到<code>leyou-common</code>中，提高复用性：</p>
<p> <img src="/images/day06/1530543778541.png" alt="1530543778541"></p>
<p><strong>不要忘记在leyou-item-service工程的pom.xml中引入leyou-common的依赖</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.leyou.common<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>leyou-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>接下来，我们编写Controller</p>
<p> <img src="/images/day06/1530549253999.png" alt="1530549253999"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"brand"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BrandController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BrandService brandService;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据查询条件分页并排序查询品牌信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rows</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sortBy</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> desc</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"page"</span>)</span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;PageResult&lt;Brand&gt;&gt; queryBrandsByPage(</span><br><span class="line">            <span class="meta">@RequestParam</span>(value = <span class="string">"key"</span>, required = <span class="keyword">false</span>)String key,</span><br><span class="line">            <span class="meta">@RequestParam</span>(value = <span class="string">"page"</span>, defaultValue = <span class="string">"1"</span>)Integer page,</span><br><span class="line">            <span class="meta">@RequestParam</span>(value = <span class="string">"rows"</span>, defaultValue = <span class="string">"5"</span>)Integer rows,</span><br><span class="line">            <span class="meta">@RequestParam</span>(value = <span class="string">"sortBy"</span>, required = <span class="keyword">false</span>)String sortBy,</span><br><span class="line">            <span class="meta">@RequestParam</span>(value = <span class="string">"desc"</span>, required = <span class="keyword">false</span>)Boolean desc</span><br><span class="line">    )&#123;</span><br><span class="line">        PageResult&lt;Brand&gt; result = <span class="keyword">this</span>.brandService.queryBrandsByPage(key, page, rows, sortBy, desc);</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(result.getItems()))&#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.notFound().build();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-1-5-Service"><a href="#6-1-5-Service" class="headerlink" title="6.1.5.Service"></a>6.1.5.Service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BrandService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BrandMapper brandMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据查询条件分页并排序查询品牌信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rows</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sortBy</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> desc</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PageResult&lt;Brand&gt; <span class="title">queryBrandsByPage</span><span class="params">(String key, Integer page, Integer rows, String sortBy, Boolean desc)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始化example对象</span></span><br><span class="line">        Example example = <span class="keyword">new</span> Example(Brand<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Example.Criteria criteria = example.createCriteria();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据name模糊查询，或者根据首字母查询</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(key)) &#123;</span><br><span class="line">            criteria.andLike(<span class="string">"name"</span>, <span class="string">"%"</span> + key + <span class="string">"%"</span>).orEqualTo(<span class="string">"letter"</span>, key);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加分页条件</span></span><br><span class="line">        PageHelper.startPage(page, rows);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加排序条件</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(sortBy)) &#123;</span><br><span class="line">            example.setOrderByClause(sortBy + <span class="string">" "</span> + (desc ? <span class="string">"desc"</span> : <span class="string">"asc"</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        List&lt;Brand&gt; brands = <span class="keyword">this</span>.brandMapper.selectByExample(example);</span><br><span class="line">        <span class="comment">// 包装成pageInfo</span></span><br><span class="line">        PageInfo&lt;Brand&gt; pageInfo = <span class="keyword">new</span> PageInfo&lt;&gt;(brands);</span><br><span class="line">        <span class="comment">// 包装成分页结果集返回</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PageResult&lt;&gt;(pageInfo.getTotal(), pageInfo.getList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-1-6-测试"><a href="#6-1-6-测试" class="headerlink" title="6.1.6.测试"></a>6.1.6.测试</h3><p>通过浏览器访问试试：<a href="http://api.leyou.com/api/item/brand/page" target="_blank" rel="noopener">http://api.leyou.com/api/item/brand/page</a></p>
<p><img src="/images/day06/1530549095150.png" alt="1530549095150"></p>
<p>接下来，去页面请求数据并渲染</p>
<h2 id="6-2-异步查询工具axios"><a href="#6-2-异步查询工具axios" class="headerlink" title="6.2.异步查询工具axios"></a>6.2.异步查询工具axios</h2><p>异步查询数据，自然是通过ajax查询，大家首先想起的肯定是jQuery。但jQuery与MVVM的思想不吻合，而且ajax只是jQuery的一小部分。因此不可能为了发起ajax请求而去引用这么大的一个库。</p>
<h3 id="6-2-1-axios入门"><a href="#6-2-1-axios入门" class="headerlink" title="6.2.1.axios入门"></a>6.2.1.axios入门</h3><p>Vue官方推荐的ajax请求框架叫做：axios，看下demo：</p>
<p> <img src="/images/day06/1526033988251.png" alt="1526033988251"></p>
<p>axios的Get请求语法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">axios.get(<span class="string">"/item/category/list?pid=0"</span>) <span class="comment">// 请求路径和请求参数拼接</span></span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span>(<span class="params">resp</span>)</span>&#123;</span><br><span class="line">    	<span class="comment">// 成功回调函数</span></span><br><span class="line">	&#125;)</span><br><span class="line">    .catch(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    	<span class="comment">// 失败回调函数</span></span><br><span class="line">	&#125;)</span><br><span class="line"><span class="comment">// 参数较多时，可以通过params来传递参数</span></span><br><span class="line">axios.get(<span class="string">"/item/category/list"</span>, &#123;</span><br><span class="line">        params:&#123;</span><br><span class="line">            pid:<span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">	&#125;)</span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span>(<span class="params">resp</span>)</span>&#123;&#125;)<span class="comment">// 成功时的回调</span></span><br><span class="line">    .catch(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;&#125;)<span class="comment">// 失败时的回调</span></span><br></pre></td></tr></table></figure>

<p>axios的POST请求语法：</p>
<p>比如新增一个用户</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">axios.post(<span class="string">"/user"</span>,&#123;</span><br><span class="line">    	name:<span class="string">"Jack"</span>,</span><br><span class="line">    	age:<span class="number">21</span></span><br><span class="line">	&#125;)</span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span>(<span class="params">resp</span>)</span>&#123;&#125;)</span><br><span class="line">    .catch(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;&#125;)</span><br></pre></td></tr></table></figure>

<p>注意，POST请求传参，不需要像GET请求那样定义一个对象，在对象的params参数中传参。post()方法的第二个参数对象，就是将来要传递的参数</p>
<p>PUT和DELETE请求与POST请求类似</p>
<h3 id="6-2-2-axios的全局配置"><a href="#6-2-2-axios的全局配置" class="headerlink" title="6.2.2.axios的全局配置"></a>6.2.2.axios的全局配置</h3><p>而在我们的项目中，已经引入了axios，并且进行了简单的封装，在src下的http.js中：</p>
<p> <img src="/images/day06/1526034150067.png" alt="1526034150067"></p>
<p>http.js中对axios进行了一些默认配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"><span class="keyword">import</span> config <span class="keyword">from</span> <span class="string">'./config'</span></span><br><span class="line"><span class="comment">// config中定义的基础路径是：http://api.leyou.com/api</span></span><br><span class="line">axios.defaults.baseURL = config.api; <span class="comment">// 设置axios的基础请求路径</span></span><br><span class="line">axios.defaults.timeout = <span class="number">2000</span>; <span class="comment">// 设置axios的请求时间</span></span><br><span class="line"></span><br><span class="line">Vue.prototype.$http = axios;<span class="comment">// 将axios赋值给Vue原型的$http属性，这样所有vue实例都可使用该对象</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>http.js中导入了config的配置，还记得吗？</p>
<p>   <img src="/images/day06/1526041205846.png" alt="1526041205846"></p>
</li>
<li><p>http.js对axios进行了全局配置：<code>baseURL=config.api</code>，即<code>http://api.leyou.com/api</code>。因此以后所有用axios发起的请求，都会以这个地址作为前缀。</p>
</li>
<li><p>通过<code>Vue.property.$http = axios</code>，将<code>axios</code>赋值给了 Vue原型中的<code>$http</code>。这样以后所有的Vue实例都可以访问到$http，也就是访问到了axios了。</p>
</li>
</ul>
<h3 id="6-2-3-项目中使用"><a href="#6-2-3-项目中使用" class="headerlink" title="6.2.3.项目中使用"></a>6.2.3.项目中使用</h3><p>我们在组件<code>Brand.vue</code>的getDataFromServer方法，通过$http发起get请求，测试查询品牌的接口，看是否能获取到数据：</p>
<p><img src="/images/day06/1543067111272.png" alt="1543067111272"></p>
<p>网络监视：</p>
<p> <img src="/images/day06/1526048143014.png" alt="1526048143014"></p>
<p>resp到底都有那些数据，查看控制台结果：</p>
<p><img src="/images/day06/1526048275064.png" alt="1526048275064"></p>
<p>可以看到，在请求成功的返回结果response中，有一个data属性，里面就是真正的响应数据。</p>
<p>响应结果中与我们设计的一致，包含3个内容：</p>
<ul>
<li>total：总条数，目前是165</li>
<li>items：当前页数据</li>
<li>totalPage：总页数，我们没有返回</li>
</ul>
<h2 id="6-3-完成分页和过滤"><a href="#6-3-完成分页和过滤" class="headerlink" title="6.3.完成分页和过滤"></a>6.3.完成分页和过滤</h2><h3 id="6-3-1-分页"><a href="#6-3-1-分页" class="headerlink" title="6.3.1.分页"></a>6.3.1.分页</h3><p>点击分页，会发起请求，通过浏览器工具查看，会发现pagination对象的属性一直在变化：</p>
<p> <img src="/images/day06/9.gif" alt></p>
<p>我们可以利用Vue的监视功能：watch，当pagination发生改变时，会调用我们的回调函数，我们在回调函数中进行数据的查询！</p>
<p>具体实现：</p>
<p><img src="/images/day06/1526049643506.png" alt="1526049643506"></p>
<p>成功实现分页功能：</p>
<p><img src="/images/day06/22.gif" alt="1526049720200"></p>
<h3 id="6-3-2-过滤"><a href="#6-3-2-过滤" class="headerlink" title="6.3.2.过滤"></a>6.3.2.过滤</h3><p>过滤字段对应的是search属性，我们只要监视这个属性即可:</p>
<p> <img src="/images/day06/1526049939985.png" alt="1526049939985"></p>
<p>查看网络请求：</p>
<p> <img src="/images/day06/1526050032436.png" alt="1526050032436"></p>
<p>页面结果：</p>
<p><img src="/images/day06/1530555740595.png" alt="1530555740595"></p>

    <div id="aplayer-EUeVfpLW" class="aplayer aplayer-tag-marker meting-tag-marker" data-id="1401656653" data-server="netease" data-type="song" data-mode="circulation" data-autoplay="true" data-mutex="true" data-listmaxheight="340px" data-preload="auto" data-theme="#555"></div>


    </div>

    
    
    
        
      
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Andrew</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://ironic333.github.io/2019/12/02/day06/" title="商品分类(vuetify-nginx-cors)">https://ironic333.github.io/2019/12/02/day06/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li>
</ul>
</div>

      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/微服务/" rel="tag"># -微服务</a>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2019/12/02/day05-vue入门/" rel="next" title="Vue入门知识">
                  <i class="fa fa-chevron-left"></i> Vue入门知识
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2019/12/07/leetcodeDay1/" rel="prev" title="每日算法题（1）">
                  每日算法题（1） <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/wang.gif"
      alt="Andrew">
  <p class="site-author-name" itemprop="name">Andrew</p>
  <div class="site-description motion-element" itemprop="description"></div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">65</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>



        </div>
      </div>
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#0-学习目标"><span class="nav-number">1.</span> <span class="nav-text">0.学习目标</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-搭建后台管理前端"><span class="nav-number">2.</span> <span class="nav-text">1.搭建后台管理前端</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-导入已有资源"><span class="nav-number">2.1.</span> <span class="nav-text">1.1.导入已有资源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-安装依赖"><span class="nav-number">2.2.</span> <span class="nav-text">1.2.安装依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-运行一下看看"><span class="nav-number">2.3.</span> <span class="nav-text">1.3.运行一下看看</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-目录结构"><span class="nav-number">2.4.</span> <span class="nav-text">1.4.目录结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-5-调用关系"><span class="nav-number">2.5.</span> <span class="nav-text">1.5.调用关系</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-Vuetify框架"><span class="nav-number">3.</span> <span class="nav-text">2.Vuetify框架</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-为什么要学习UI框架"><span class="nav-number">3.1.</span> <span class="nav-text">2.1.为什么要学习UI框架</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-为什么是Vuetify"><span class="nav-number">3.2.</span> <span class="nav-text">2.2.为什么是Vuetify</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-怎么用？"><span class="nav-number">3.3.</span> <span class="nav-text">2.3.怎么用？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-项目页面布局"><span class="nav-number">3.4.</span> <span class="nav-text">2.4.项目页面布局</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-使用域名访问本地项目"><span class="nav-number">4.</span> <span class="nav-text">3.使用域名访问本地项目</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-统一环境"><span class="nav-number">4.1.</span> <span class="nav-text">3.1.统一环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-域名解析"><span class="nav-number">4.2.</span> <span class="nav-text">3.2.域名解析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-解决域名解析问题"><span class="nav-number">4.3.</span> <span class="nav-text">3.3.解决域名解析问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-nginx解决端口问题"><span class="nav-number">4.4.</span> <span class="nav-text">3.4.nginx解决端口问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-1-什么是Nginx"><span class="nav-number">4.4.1.</span> <span class="nav-text">3.4.1.什么是Nginx</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-2-nginx作为web服务器"><span class="nav-number">4.4.2.</span> <span class="nav-text">3.4.2.nginx作为web服务器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-3-nginx作为反向代理"><span class="nav-number">4.4.3.</span> <span class="nav-text">3.4.3.nginx作为反向代理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-4-安装和使用"><span class="nav-number">4.4.4.</span> <span class="nav-text">3.4.4.安装和使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装"><span class="nav-number">4.4.5.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#反向代理配置"><span class="nav-number">4.4.6.</span> <span class="nav-text">反向代理配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用"><span class="nav-number">4.4.7.</span> <span class="nav-text">使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-5-测试"><span class="nav-number">4.5.</span> <span class="nav-text">3.5.测试</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-实现商品分类查询"><span class="nav-number">5.</span> <span class="nav-text">4.实现商品分类查询</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-导入数据"><span class="nav-number">5.1.</span> <span class="nav-text">4.1.导入数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-实现功能"><span class="nav-number">5.2.</span> <span class="nav-text">4.2.实现功能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-1-url异步请求"><span class="nav-number">5.2.1.</span> <span class="nav-text">4.2.1.url异步请求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-2-实体类"><span class="nav-number">5.2.2.</span> <span class="nav-text">4.2.2.实体类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-3-controller"><span class="nav-number">5.2.3.</span> <span class="nav-text">4.2.3.controller</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-4-service"><span class="nav-number">5.2.4.</span> <span class="nav-text">4.2.4.service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-5-mapper"><span class="nav-number">5.2.5.</span> <span class="nav-text">4.2.5.mapper</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-6-启动并测试"><span class="nav-number">5.2.6.</span> <span class="nav-text">4.2.6.启动并测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-跨域问题"><span class="nav-number">6.</span> <span class="nav-text">5.跨域问题</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-为什么有跨域问题？"><span class="nav-number">6.1.</span> <span class="nav-text">5.1.为什么有跨域问题？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-解决跨域问题的方案"><span class="nav-number">6.2.</span> <span class="nav-text">5.2.解决跨域问题的方案</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-cors解决跨域"><span class="nav-number">6.3.</span> <span class="nav-text">5.3.cors解决跨域</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-1-什么是cors"><span class="nav-number">6.3.1.</span> <span class="nav-text">5.3.1.什么是cors</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-2-原理有点复杂"><span class="nav-number">6.3.2.</span> <span class="nav-text">5.3.2.原理有点复杂</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-2-1-简单请求"><span class="nav-number">6.3.2.1.</span> <span class="nav-text">5.3.2.1.简单请求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-2-2-特殊请求"><span class="nav-number">6.3.2.2.</span> <span class="nav-text">5.3.2.2.特殊请求</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-3-实现非常简单"><span class="nav-number">6.3.3.</span> <span class="nav-text">5.3.3.实现非常简单</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-品牌的查询"><span class="nav-number">7.</span> <span class="nav-text">6.品牌的查询</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-后台提供查询接口"><span class="nav-number">7.1.</span> <span class="nav-text">6.1.后台提供查询接口</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-1-数据库表"><span class="nav-number">7.1.1.</span> <span class="nav-text">6.1.1.数据库表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-2-实体类"><span class="nav-number">7.1.2.</span> <span class="nav-text">6.1.2.实体类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-3-mapper"><span class="nav-number">7.1.3.</span> <span class="nav-text">6.1.3.mapper</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-4-controller"><span class="nav-number">7.1.4.</span> <span class="nav-text">6.1.4.controller</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-5-Service"><span class="nav-number">7.1.5.</span> <span class="nav-text">6.1.5.Service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-6-测试"><span class="nav-number">7.1.6.</span> <span class="nav-text">6.1.6.测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2-异步查询工具axios"><span class="nav-number">7.2.</span> <span class="nav-text">6.2.异步查询工具axios</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-1-axios入门"><span class="nav-number">7.2.1.</span> <span class="nav-text">6.2.1.axios入门</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-2-axios的全局配置"><span class="nav-number">7.2.2.</span> <span class="nav-text">6.2.2.axios的全局配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-3-项目中使用"><span class="nav-number">7.2.3.</span> <span class="nav-text">6.2.3.项目中使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-3-完成分页和过滤"><span class="nav-number">7.3.</span> <span class="nav-text">6.3.完成分页和过滤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-1-分页"><span class="nav-number">7.3.1.</span> <span class="nav-text">6.3.1.分页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-2-过滤"><span class="nav-number">7.3.2.</span> <span class="nav-text">6.3.2.过滤</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Andrew</span>
</div>
<span id="busuanzi_container_site_uv">
  本站访问次数：<span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
</span>
<!--
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.3.0</div>
-->
        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>








        
      </div>
    </footer>
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
      </div>

    

  </div>

  
    
    
  
    
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/jquery/index.js?v=3.4.1"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  <script defer src="/lib/three/three.min.js"></script>
  <script defer src="/lib/three/canvas_lines.min.js"></script>

<script src="/js/utils.js?v=7.3.0"></script>
  <script src="/js/motion.js?v=7.3.0"></script>


  <script src="/js/affix.js?v=7.3.0"></script>
  <script src="/js/schemes/pisces.js?v=7.3.0"></script>


<script src="/js/next-boot.js?v=7.3.0"></script>




  















  <script src="/js/local-search.js?v=7.3.0"></script>














  

  

  


  
  <script src="/js/scrollspy.js?v=7.3.0"></script>
<script src="/js/post-details.js?v=7.3.0"></script>


  
   <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas> 
   <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
   <script type="text/javascript" src="/js/src/fireworks.js"></script>


<script type="text/javascript"
color="0,0,255" opacity='0.7' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
